import { useStyleInject as C } from "../StyleContext.mjs";
import { shallowRef as f, watchEffect as d, watch as v, onBeforeUnmount as x } from "vue";
function y(i, h, m, u) {
  const n = C(), t = f(""), r = f();
  d(() => {
    t.value = [i, ...h.value].join("%");
  });
  const s = (l) => {
    n.value.cache.update(l, (e) => {
      const [a = 0, c] = e || [];
      return a - 1 === 0 ? (u == null || u(c, !1), null) : [a - 1, c];
    });
  };
  return v(t, (l, e) => {
    e && s(e), n.value.cache.update(l, (a) => {
      const [c = 0, o] = a || [], p = o || m();
      return [c + 1, p];
    }), r.value = n.value.cache.get(t.value)[1];
  }, {
    immediate: !0
  }), x(() => {
    s(t.value);
  }), r;
}
export {
  y as default
};
